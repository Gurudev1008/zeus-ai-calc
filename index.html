<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ZEUS AI — Калькулятор v2.0 (single-file)</title>
<meta name="color-scheme" content="dark light"/>
<style>
/* inlined styles (short subset) */
:root{--bg:#0b0f17;--panel:#121826;--text:#e6ecff;--muted:#9aa4bf;--accent:#7DF3FF;--accent2:#8E7DFF;--good:#00d084;--border:#1e2638}
:root.light{--bg:#fff;--panel:#f5f7fb;--text:#1a2240;--muted:#4d5a7a;--accent:#0077ff;--accent2:#5a2eff;--good:#1a9c68;--border:#e2e8f0}
*{box-sizing:border-box}html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.4 Inter,system-ui,Arial}
.container{max-width:1200px;margin:0 auto;padding:24px}
.header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
.header .title{font-size:20px;font-weight:800;letter-spacing:.03em}
.toolbar{display:flex;gap:8px;margin-left:auto}
.btn{padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,var(--panel),rgba(255,255,255,.03));color:var(--text);cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
.card{background:linear-gradient(180deg,var(--panel),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:16px;padding:16px}
.card h3{margin:0 0 8px;font-size:14px;color:var(--muted);letter-spacing:.12em;text-transform:uppercase}
.input-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
.tile{display:flex;align-items:center;gap:10px;padding:12px;border:1px solid var(--border);border-radius:12px;background:rgba(255,255,255,.02)}
.tile input,.tile select{width:160px;padding:10px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text)}
.small{font-size:12px;color:var(--muted)}.hl-good{box-shadow:0 0 0 2px var(--good) inset}
.kpi{display:flex;gap:12px;flex-wrap:wrap}.meter{flex:1;min-width:180px;border:1px solid var(--border);border-radius:14px;padding:12px}
.value{font-size:22px;font-weight:800}.progress{height:10px;background:var(--border);border-radius:999px;overflow:hidden;margin-top:8px}
.progress>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%;transition:width .8s ease}
.line,.pie{width:100%;height:320px}
.tabs{display:flex;gap:8px;margin-bottom:8px}.tab{padding:8px 12px;border:1px solid var(--border);border-radius:12px;cursor:pointer}
.tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:black;font-weight:700}
@media (max-width:900px){.grid{grid-template-columns:1fr}.input-row{grid-template-columns:1fr}}
@media print{.toolbar{display:none}body{background:#fff;color:#000}.card{page-break-inside:avoid}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="title">ZEUS AI — Финансовый калькулятор v2.0</div>
    <div class="toolbar">
      <button class="btn" id="saveBtn">Сохранить сценарий</button>
      <button class="btn" id="loadBtn">Загрузить</button>
      <button class="btn" id="pdfBtn">PDF</button>
      <button class="btn" id="langBtn">RU / EN</button>
    </div>
  </div>

  <div class="grid">
    <div class="card" style="grid-column: span 12;">
      <h3>Параметры</h3>
      <div class="tabs" id="scTabs">
        <div class="tab active" data-scenario="base">Базовый</div>
        <div class="tab" data-scenario="opt">Оптимистичный</div>
        <div class="tab" data-scenario="pes">Пессимистичный</div>
      </div>
      <div class="input-row">
        <div class="tile"><label>Годовая ставка, %</label><input type="number" id="apr" value="24" step="0.1"></div>
        <div class="tile"><label>Комиссия, %</label><input type="number" id="fee" value="10" step="0.1"></div>
      </div>
      <div class="input-row">
        <div class="tile"><label>Первоначальная сумма</label><input type="number" id="principal" value="3000" step="100"></div>
        <div class="tile"><label>Регулярное пополнение / мес</label><input type="number" id="contrib" value="200" step="50"></div>
      </div>
      <div class="input-row">
        <div class="tile"><label>Срок, лет</label><input type="number" id="years" value="3" step="1"></div>
        <div class="tile"><label>Инфляция, %</label><input type="number" id="infl" value="6" step="0.1"></div>
      </div>
      <div class="input-row">
        <div class="tile"><label>Валюта</label><select id="currency"><option>$</option><option>€</option><option>₽</option></select></div>
        <div class="tile" id="bigDepositTile"><label>EAR (эффективная)</label><div><span id="earOut">—</span></div></div>
      </div>
      <div class="small">Подсказка: если депозит ≥ $10 000 — плитка подсветится зелёным.</div>
    </div>

    <div class="card" style="grid-column: span 6;">
      <h3>Рост депозита</h3>
      <svg class="line" id="lineChart"></svg>
    </div>

    <div class="card" style="grid-column: span 6;">
      <h3>Структура дохода</h3>
      <svg class="pie" id="pieChart"></svg>
      <div class="kpi">
        <div class="meter"><div class="small">ROI</div><div class="value" id="roi">—</div><div class="progress"><div id="roiBar"></div></div></div>
        <div class="meter"><div class="small">CAGR</div><div class="value" id="cagr">—</div><div class="progress"><div id="cagrBar"></div></div></div>
        <div class="meter"><div class="small">IRR</div><div class="value" id="irr">—</div><div class="progress"><div id="irrBar"></div></div></div>
      </div>
    </div>

    <div class="card" style="grid-column: span 12;">
      <h3>Партнёрская программа</h3>
      <div class="input-row">
        <label class="tile"><span>Учитывать партнёрку</span><input type="checkbox" id="useAff" checked></label>
        <label class="tile"><span>Средняя прибыль партнёра / мес</span><input type="number" id="affAvg" value="80" step="10"></label>
      </div>
      <div class="input-row">
        <div class="tile"><label>L1 %</label><input type="number" id="l1" value="10"></div>
        <div class="tile"><label>L2 %</label><input type="number" id="l2" value="5"></div>
      </div>
      <div class="input-row">
        <div class="tile"><label>L3 %</label><input type="number" id="l3" value="3"></div>
        <div class="tile"><label>L4 %</label><input type="number" id="l4" value="2"></div>
      </div>
      <div class="small" id="affBreakdown"></div>
    </div>

    <div class="card" style="grid-column: span 12;">
      <h3>Отчёт</h3>
      <div class="small" id="invested">Внесено: —</div>
      <div class="small" id="earned">Проценты: —</div>
      <div class="small" id="partnerIncome">Партнёрка: —</div>
      <div class="small" id="totalOut">Итого: —</div>
      <div class="small" id="avgMonth">В месяц: —</div>
    </div>
  </div>
</div>

<script>
const Utils={line:(el,points,minY,maxY)=>{const W=el.clientWidth,H=el.clientHeight,pad=24;el.setAttribute("viewBox",`0 0 ${W} ${H}`);el.innerHTML="";const xs=points.map((p,i)=>[pad+i*(W-2*pad)/(points.length-1),p]);const min=minY??Math.min(...points),max=maxY??Math.max(...points);const mapY=v=>H-pad-((v-min)/(max-min||1))*(H-2*pad);const grid=document.createElementNS("http://www.w3.org/2000/svg","g");for(let i=0;i<=4;i++){const y=pad+i*(H-2*pad)/4;const l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1",pad);l.setAttribute("x2",W-pad);l.setAttribute("y1",y);l.setAttribute("y2",y);l.setAttribute("stroke","var(--border)");l.setAttribute("stroke-width","1");grid.appendChild(l)}el.appendChild(grid);const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",xs.map((p,i)=>`${i?"L":"M"}${p[0]},${mapY(p[1])}`).join(" "));p.setAttribute("fill","none");p.setAttribute("stroke","url(#gradLine)");p.setAttribute("stroke-width","3");const defs=document.createElementNS("http://www.w3.org/2000/svg","defs");const grad=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");grad.setAttribute("id","gradLine");grad.innerHTML=`<stop offset="0%" stop-color="var(--accent)"/><stop offset="100%" stop-color="var(--accent2)"/>`;defs.appendChild(grad);el.appendChild(defs);el.appendChild(p)},
pie:(el,values)=>{const total=values.reduce((a,b)=>a+b,0)||1,W=el.clientWidth,H=el.clientHeight,r=Math.min(W,H)/2-16,cx=W/2,cy=H/2;el.setAttribute("viewBox",`0 0 ${W} ${H}`);el.innerHTML="";let ang=-Math.PI/2;const colors=["var(--accent)","var(--accent2)","var(--good)","var(--muted)"];values.forEach((v,i)=>{const slice=v/total*Math.PI*2,x1=cx+r*Math.cos(ang),y1=cy+r*Math.sin(ang),x2=cx+r*Math.cos(ang+slice),y2=cy+r*Math.sin(ang+slice),large=slice>Math.PI?1:0,d=`M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`;const path=document.createElementNS("http://www.w3.org/2000/svg","path");path.setAttribute("d",d);path.setAttribute("fill",colors[i%colors.length]);el.appendChild(path);ang+=slice})},
irr:(c,g=.1)=>{let r=g;for(let i=0;i<50;i++){let npv=0,d=0;c.forEach((x,t)=>{const df=(1+r)**t;npv+=x/df;d-=t*x/(df*(1+r))});const nr=r-npv/(d||1e-9);if(!isFinite(nr))break;if(Math.abs(nr-r)<1e-7)return r;r=nr}return r},
cagr:(s,e,y)=>s<=0||y<=0?0:(e/s)**(1/y)-1,roi:(g,c)=>c<=0?0:g/c,fmt:v=>{if(typeof v!=="number"||isNaN(v))return"—";return v>=1e6?(v/1e6).toFixed(2)+"M":v>=1e3?(v/1e3).toFixed(2)+"k":v.toFixed(2)},pct:v=>(v*100).toFixed(2)+"%"};

function recalc(){
  const aprBase=+document.getElementById("apr").value;
  const fee=+document.getElementById("fee").value;
  const years=+document.getElementById("years").value;
  const inflBase=+document.getElementById("infl").value;
  const contrib=+document.getElementById("contrib").value;
  const scenario=document.querySelector(".tab.active").dataset.scenario;
  let apr=aprBase, infl=inflBase;
  if(scenario==="opt"){apr=aprBase+6; infl=Math.max(0,inflBase-2)}
  if(scenario==="pes"){apr=Math.max(0,aprBase-6); infl=inflBase+3}
  const ear = ((1+((apr/100)*(1-fee/100))/12)**12-1)*100;
  document.getElementById("earOut").textContent = ear.toFixed(2)+"%";
  const principal=+document.getElementById("principal").value;
  document.getElementById("bigDepositTile").classList.toggle("hl-good", principal>=10000);
  const months=Math.max(1,years*12|0); let bal=principal; let invested=principal;
  const nm = ((apr/100)*(1-fee/100))/12;
  const series=[bal]; const cash=[-principal];
  for(let t=1;t<=months;t++){ bal = bal*(1+nm)+contrib; series.push(bal); invested+=contrib; cash.push(-contrib); }
  const end=series[series.length-1], gain=Math.max(0,end-invested);
  let partner=0; if(document.getElementById("useAff").checked){
    const avg=+document.getElementById("affAvg").value;
    const p=[+"l1","l2","l3","l4".split()].map;
  }
  // partner simple
  const l1=+document.getElementById("l1").value/100, l2=+document.getElementById("l2").value/100, l3=+document.getElementById("l3").value/100, l4=+document.getElementById("l4").value/100;
  const affAvg=+document.getElementById("affAvg").value;
  const monthsAff = months; // равен сроку
  const pctSum=l1+l2+l3+l4;
  partner = affAvg*pctSum*monthsAff;
  // KPI
  const roi=Utils.roi(gain+partner, invested);
  const cagr=Utils.cagr(invested, end+partner, months/12);
  const irr=Utils.irr(cash.concat(Array.from({length:monthsAff},(_,i)=>affAvg*pctSum)));
  document.getElementById("roi").textContent=Utils.pct(roi);
  document.getElementById("cagr").textContent=Utils.pct(cagr);
  document.getElementById("irr").textContent=Utils.pct(irr);
  document.getElementById("roiBar").style.width=Math.min(200,roi*100)+"%";
  document.getElementById("cagrBar").style.width=Math.min(100,Math.abs(cagr)*100)+"%";
  document.getElementById("irrBar").style.width=Math.min(100,Math.abs(irr)*100)+"%";
  Utils.line(document.getElementById("lineChart"), series, Math.min(...series)*.98, Math.max(...series)*1.02);
  Utils.pie(document.getElementById("pieChart"), [gain, Math.max(0,partner), invested]);
  document.getElementById("invested").textContent="Внесено: $"+Utils.fmt(invested);
  document.getElementById("earned").textContent="Проценты: $"+Utils.fmt(gain);
  document.getElementById("partnerIncome").textContent="Партнёрка: $"+Utils.fmt(partner);
  document.getElementById("totalOut").textContent="Итого: $"+Utils.fmt(end+partner);
  document.getElementById("avgMonth").textContent="В месяц: $"+Utils.fmt((end+partner-invested)/months);
  document.getElementById("affBreakdown").textContent=`L1: $${(affAvg*l1).toFixed(2)}/мес · L2: $${(affAvg*l2).toFixed(2)} · L3: $${(affAvg*l3).toFixed(2)} · L4: $${(affAvg*l4).toFixed(2)}`;
}
document.getElementById("pdfBtn").onclick=()=>window.print();
document.getElementById("loadBtn").onclick=()=>{const i=document.createElement("input");i.type="file";i.accept=".json,application/json";i.onchange=()=>{const f=i.files[0],r=new FileReader();r.onload=()=>{const d=JSON.parse(r.result);for(const k of ["apr","fee","principal","contrib","years","infl","l1","l2","l3","l4","affAvg"])if(d[k]!=null)document.getElementById(k).value=d[k];recalc()};r.readAsText(f)};i.click()};
document.getElementById("saveBtn").onclick=()=>{const d={};for(const k of ["apr","fee","principal","contrib","years","infl","l1","l2","l3","l4","affAvg"])d[k]=document.getElementById(k).value;const blob=new Blob([JSON.stringify(d,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="scenario.json";a.click()};
document.getElementById("scTabs").addEventListener("click",e=>{if(e.target.classList.contains("tab")){document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));e.target.classList.add("active");recalc()}});
window.addEventListener("load",recalc); window.addEventListener("input",e=>{if(e.target.closest(".tile"))recalc()});
</script>
</body></html>
