
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ZEUS AI • Калькулятор сложных процентов</title>
<link rel="icon" href="../assets/favicon.svg"/>
<style>
:root{--bg:#0b1330;--panel:#0f1d3f;--text:#d7eaff;--muted:#9fb7ff;--cyan:#38e8ff;--orange:#ff8a2a;--lime:#9cff70;--pink:#ff5bbd;--border:#38e8ff33;--tipbg:#0c1a3a}
*{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto;color:var(--text);
  background:radial-gradient(1000px 600px at 85% 10%, rgba(56,232,255,.08) 0%, rgba(56,232,255,0) 70%),
             radial-gradient(1200px 600px at 10% 0%,#13214a 0%,#0b1330 55%,#081027 100%)}
.wrap{max-width:1280px;margin:24px auto;padding:0 16px}
.head{display:flex;gap:12px;align-items:center;margin-bottom:18px;position:sticky;top:0;z-index:20;background:linear-gradient(180deg,rgba(11,19,48,.9),rgba(11,19,48,.6));backdrop-filter:blur(6px);border-bottom:1px solid var(--border);padding:10px 12px;border-radius:12px}
.logo{width:28px;height:28px;filter:drop-shadow(0 0 8px rgba(56,232,255,.4))}
.brand{font-size:13px;letter-spacing:1.6px;color:#9bdfff} h1{margin:0;font-size:26px;color:var(--cyan)}
.grid{display:grid;grid-template-columns:minmax(440px,560px) minmax(520px,1fr);gap:22px}
.card{background:linear-gradient(180deg,var(--panel),#0b1836);border:1px solid var(--border);border-radius:18px;padding:18px;box-shadow:0 0 0 1px rgba(56,232,255,.06) inset, 0 24px 48px -24px rgba(0,0,0,.6), inset 0 30px 80px -60px rgba(56,232,255,.2)}
.ctitle{display:flex;justify-content:space-between;align-items:center;margin:0 0 12px}
.ctitle h3{margin:0;color:var(--cyan)}
.fields{display:grid;gap:14px}
.row{display:grid;gap:10px}
.row.two{grid-template-columns:1fr 1fr}
.row.three{grid-template-columns:1fr 1fr 1fr}
label{font-size:13px;letter-spacing:.4px}
input,select{background:rgba(255,255,255,.02);border:1px solid #38e8ff30;color:var(--text);padding:12px 14px;border-radius:12px;outline:none;font-size:16px}
.hint{opacity:.9;color:var(--muted);font-size:12px}
.pill{padding:6px 10px;border:1px solid #38e8ff44;border-radius:999px}
.stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.stat{display:grid;gap:6px}.stat small{color:var(--muted)}.stat b{font-size:26px}
.tip{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;background:#112552;border:1px solid #38e8ff80;border-radius:50%;font-size:11px;font-weight:700;color:#9bdfff;cursor:help;position:relative;margin-left:6px}
.tip::after{content:attr(data-tip);position:absolute;bottom:130%;left:50%;transform:translateX(-50%) scale(.95);opacity:0;pointer-events:none;background:var(--tipbg);color:#d7eaff;border:1px solid #38e8ff80;border-radius:10px;padding:10px 12px;min-width:220px;max-width:360px;box-shadow:0 10px 30px rgba(0,0,0,.5),0 0 20px #38e8ff33;transition:.15s ease;z-index:50}
.tip::before{content:"";position:absolute;bottom:120%;left:50%;transform:translateX(-50%);border:8px solid transparent;border-top-color:var(--tipbg);opacity:0;transition:.15s ease;z-index:49}
.tip:hover::after,.tip:hover::before,.tip.open::after,.tip.open::before{opacity:1;transform:translateX(-50%) scale(1)}
.tabs{display:flex;gap:8px;margin-bottom:6px}
.tab{padding:6px 12px;border:1px solid var(--border);border-radius:10px;user-select:none}
.tab.active{background:#12305b}
.kpiRow{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.kpi{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:10px;display:grid;gap:4px}
.kpi .title{color:var(--muted);font-size:12px}
.kpi .value{font-weight:700}
.kpiAff{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px}
.kpiAff .mini{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:10px;display:grid;gap:6px}
.kpiAff .mini .val{font-weight:700}
.lvlKPI{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:8px}
.lvlKPI .box{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:10px;display:grid;gap:4px}
.legend{opacity:.9;font-size:12px;margin-top:6px}
@media (max-width:980px){.grid{grid-template-columns:1fr}.kpiRow{grid-template-columns:1fr}.kpiAff{grid-template-columns:1fr}.stats{grid-template-columns:1fr}.lvlKPI{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="head">
    <svg class="logo" viewBox="0 0 24 24"><path fill="#38e8ff" d="M13 2 3 14h6l-2 8 10-12h-6z"/></svg>
    <div><div class="brand">ZEUS AI</div><h1>Калькулятор сложных процентов</h1></div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="ctitle"><h3>Параметры</h3><span class="pill">ZEUS AI</span></div>

      <div class="tabs">
        <!-- Только «Месячная ставка»; кнопка «Годовая ставка» удалена -->
        <div class="tab active" id="tabMonth">Месячная ставка</div>
      </div>

      <div class="fields">
        <div class="row two">
          <label><div>Мой депозит <span class="tip" data-tip="Сколько вы вносите на старте. Порог партнёрки: 1–2 уровни ≥ $3k, 3-й ≥ $10k, 4-й ≥ $20k.">i</span></div><input type="number" id="initial" value="3000" min="0"/></label>
          <label><div>Валюта</div><select id="currency"><option>$</option><option>₽</option><option>€</option><option>Rp</option><option>₹</option></select></label>
        </div>
        <div class="row two">
          <label><div>Регулярное пополнение</div><input type="number" id="contrib" value="1000" min="0"/></label>
          <label><div>Частота пополнений</div><select id="contribFreq"><option value="0">Нет</option><option value="12" selected>Ежемесячно (12)</option><option value="4">Ежеквартально (4)</option><option value="1">Ежегодно (1)</option></select></label>
        </div>

        <div class="row two">
          <label><div>Годовая ставка, % <span class="tip" data-tip="Меняете годовую — пересчитаем месячную.">i</span></div><input type="number" id="rate" value="60" step="0.01"/></label>
          <label><div>Месячная ставка, % <span class="tip" data-tip="Меняете месячную — пересчитаем годовую (EAR).">i</span></div><input type="number" id="mrate" value="4" step="0.01"/></label>
        </div>

        <div class="row two">
          <label><div>Капитализация</div><select id="compound"><option value="12" selected>Ежемесячно (12)</option><option value="4">Ежеквартально (4)</option><option value="1">Ежегодно (1)</option></select></label>
          <label><div>Колебания в месяц, % <span class="tip" data-tip="Во сколько процентов месячная ставка может отклоняться вверх/вниз. Используем для диапазона и средней годовой.">i</span></div><input type="number" id="vol" value="3" step="0.1"/></label>
        </div>

        <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="useAvg" checked/> использовать среднюю годовую (с колебаниями)</label>

        <div class="kpiRow">
          <div class="kpi"><div class="title">Годовая из месячной (EAR)</div><div class="value" id="kpiEar">—</div><div class="hint">Формула: (1+m)^12−1</div></div>
          <div class="kpi"><div class="title">Диапазон годовой (±)</div><div class="value" id="kpiRange">—</div><div class="hint">Нижняя/верхняя при m±δ</div></div>
          <div class="kpi"><div class="title">Средняя годовая (колебания)</div><div class="value" id="kpiGeo">—</div><div class="hint">Геом. ожидание для m−δ, m, m+δ</div></div>
        </div>

        <div class="row two">
          <label><div>Комиссия в год, %</div><input type="number" id="fee" value="0.01" step="0.01"/></label>
          <label><div>Инфляция, %</div><input type="number" id="infl" value="0" step="0.01"/></label>
        </div>
        <div class="row two">
          <label><div>Годы</div><input type="number" id="years" value="3" min="1"/></label>
          <div class="hint" style="align-self:end">EAR/кпи обновляются на лету.</div>
        </div>

        <div class="row two">
          <label><div>Чувствительность ставки ± (UI)</div><input type="range" id="sensRate" min="0" max="20" step="0.5" value="0"/></label>
          <label><div>Чувствительность пополнения ± (UI)</div><input type="range" id="sensContrib" min="0" max="50" step="1" value="0"/></label>
        </div>
        <div class="hint">Подсказка: поставьте пополнение = 0, чтобы увидеть чистую капитализацию.</div>
      </div>
    </div>

    <div class="card">
      <div class="ctitle"><h3>Результаты</h3><span class="pill">NEON MODE</span></div>
      <div class="stats">
        <div class="stat"><small>Итоговый баланс</small><b id="final" style="color:var(--cyan)">—</b></div>
        <div class="stat"><small>Всего пополнений</small><b id="tcontrib" style="color:var(--orange)">—</b></div>
        <div class="stat"><small>Начисленные проценты</small><b id="tinterest" style="color:var(--lime)">—</b></div>
      </div>
      <div class="pill" style="margin:10px 0">Эффективная годовая ставка (EAR): <b id="earVal">—</b></div>
      <canvas id="chart" height="320"></canvas>
      <div class="legend">Легенда кликабельна — можно скрывать линии.</div>
      <table style="width:100%;border-collapse:collapse;font-size:14px;margin-top:8px">
        <thead><tr><th>Год</th><th>Баланс</th><th>Реально (с инфляцией)</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <div class="ctitle"><h3>Партнёрская программа (копитрейдинг)</h3><span class="pill">Доход от сети</span></div>
    <div class="fields">
      <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="affOn" checked/> Учитывать партнёрские вознаграждения</label>

      <div class="row three">
        <label><div>Месяцев учёта</div><input type="number" id="affMonths" value="36" min="1"/></label>
        <label><div>Партнёров 1-го уровня</div><input type="number" id="affL1" value="20" min="0"/></label>
        <label><div>Партнёров 2-го уровня</div><input type="number" id="affL2" value="50" min="0"/></label>
      </div>
      <div class="row two">
        <label><div>Партнёров 3-го уровня</div><input type="number" id="affL3" value="100" min="0"/></label>
        <label><div>Партнёров 4-го уровня</div><input type="number" id="affL4" value="300" min="0"/></label>
      </div>

      <label style="display:flex;gap:8px;align-items:center;margin-top:6px">
        <input type="checkbox" id="calcAvgFromDep" checked/> Считать среднюю прибыль партнёра от его депозита и месячной ставки
      </label>
      <div id="avgBlock">
        <div class="row three">
          <label><div>Депозит A (мин.)</div><input type="number" id="depA" value="3000" min="3000"/></label>
          <label><div>Депозит B</div><input type="number" id="depB" value="10000" min="3000"/></label>
          <label><div>Депозит C</div><input type="number" id="depC" value="20000" min="3000"/></label>
        </div>
        <div class="row three">
          <label><div>Доля A, %</div><input type="number" id="wA" value="40" min="0" max="100"/></label>
          <label><div>Доля B, %</div><input type="number" id="wB" value="40" min="0" max="100"/></label>
          <label><div>Доля C, %</div><input type="number" id="wC" value="20" min="0" max="100"/></label>
        </div>
        <div class="kpiAff" style="grid-template-columns:1fr">
          <div class="mini"><div class="label">Средняя прибыль партнёра/мес (расчётная)</div><div class="val" id="affAvgCalc">—</div></div>
        </div>
      </div>

      <div class="lvlKPI">
        <div class="box"><div class="label">L1 / мес (5%)</div><div class="val" id="l1m">—</div></div>
        <div class="box"><div class="label">L2 / мес (8%)</div><div class="val" id="l2m">—</div></div>
        <div class="box"><div class="label">L3 / мес (10%)</div><div class="val" id="l3m">—</div></div>
        <div class="box"><div class="label">L4 / мес (2%)</div><div class="val" id="l4m">—</div></div>
      </div>

      <div class="kpiAff">
        <div class="mini"><div class="label">Собственный доход (моя доля прибыли)</div><div class="val" id="ownShare">—</div><div class="hint" id="ownShareHint">—</div></div>
        <div class="mini"><div class="label">Партнёрский доход за период</div><div class="val" id="affTotal">—</div><div class="hint" id="affLevelsHint">Уровни: —</div></div>
        <div class="mini"><div class="label">Итого: собственный + партнёрский</div><div class="val" id="grandTotal">—</div><div class="hint" id="affPerMonth">В среднем в месяц: —</div></div>
      </div>

      <div class="row two">
        <label><div>Моя доля от прибыли депозита</div>
          <select id="ownSharePct">
            <option value="50">50% (депозит ≥ $3k)</option>
            <option value="60">60% (депозит ≥ $10k)</option>
            <option value="70">70% (депозит ≥ $20k)</option>
          </select>
        </label>
        <div class="hint" id="ownShareLock">Недоступные варианты автоматически станут активны при достижении порога депозита.</div>
      </div>
      <div class="hint">Доля партнёрки = <b id="partnerShareText">50%</b>. Сумма долей всегда 100%.</div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<script>
const gi = (id)=>document.getElementById(id);
const fmt = (sym,n)=>`${sym} ${(+n).toLocaleString(undefined,{maximumFractionDigits:2})}`;
const lcm=(a,b)=>{const g=(x,y)=>y===0?x:g(y,x%y);return a*b/g(a,b)};
function simulate({initial,contrib,contribFreq,rate,fee,infl,compound,years,timing='end',currency:'$'}){
  const n=Math.max(1,Math.floor(compound||1));const m=Math.max(0,Math.floor(contribFreq||0));
  const steps=(m===0? n : lcm(n,m)), compEvery=steps/n, contEvery=(m===0? Infinity : steps/m);
  const rNet=(rate - (fee||0))/100; let bal=+initial||0, totalC=0, invested=+initial||0; const yearly=[], investedYearly=[];
  for(let y=1;y<=years;y++){
    for(let s=1;s<=steps;s++){
      if(timing==='begin' && ((s-1)%contEvery===0) && contrib>0){bal+=+contrib; totalC+=+contrib; invested+=+contrib;}
      if(s%compEvery===0){ bal*=1+(rNet/n);}
      if(timing==='end' && (s%contEvery===0) && contrib>0){bal+=+contrib; totalC+=+contrib; invested+=+contrib;}
    }
    const real=infl? bal/Math.pow(1+infl/100,y):bal; yearly.push({year:y,balance:bal,real}); investedYearly.push(invested);
  }
  const ear=Math.pow(1+(rNet/n),n)-1; return {final:bal,totalC,interest:bal-(+initial+totalC),yearly,investedYearly,ear};
}
function annualToMonthly(r){return Math.pow(1+r/100,1/12)-1}
function monthlyToAnnual(m){return (Math.pow(1+m,12)-1)*100}
function clamp(x,min,max){return Math.min(max,Math.max(min,x))}

let chart; let lastEdit='annual';
['rate','mrate'].forEach(id=> gi(id).addEventListener('input', e=>{ lastEdit=(id==='mrate'?'monthly':'annual'); render(); }));
['initial','contrib','contribFreq','fee','infl','compound','years','currency','vol','useAvg',
 'sensRate','sensContrib','affMonths','affL1','affL2','affL3','affL4','calcAvgFromDep','depA','depB','depC','wA','wB','wC','ownSharePct']
  .forEach(id=> gi(id).addEventListener('input', render));

document.addEventListener('click', (e)=>{
  if(e.target.classList.contains('tip')) e.target.classList.toggle('open');
  else document.querySelectorAll('.tip.open').forEach(t=>t.classList.remove('open'));
});

function render(){
  // Two-way sync (keep both inputs; removed only the Year tab button)
  if(lastEdit==='annual'){ gi('mrate').value = (annualToMonthly(+gi('rate').value||0)*100).toFixed(4); }
  else { gi('rate').value = monthlyToAnnual((+gi('mrate').value||0)/100).toFixed(4); }

  const m = (+gi('mrate').value||0)/100;
  const delta = (+(gi('vol').value)||0)/100;
  const ear = monthlyToAnnual(m);
  const lo = monthlyToAnnual(clamp(m-delta,-0.99,10));
  const hi = monthlyToAnnual(m+delta);
  const geoMonth = Math.cbrt( (1+clamp(m-delta,-0.99,10))*(1+m)*(1+(m+delta)) ) - 1;
  const geoYear = monthlyToAnnual(geoMonth);
  gi('kpiEar').textContent = ear.toFixed(2)+'%';
  gi('kpiRange').textContent = `${lo.toFixed(1)}% … ${hi.toFixed(1)}%`;
  gi('kpiGeo').textContent = geoYear.toFixed(2)+'%';
  gi('earVal').textContent = (gi('useAvg').checked ? geoYear : ear).toFixed(2)+'%';

  // Sensitivity tweaks (visual only)
  const sensRate = (+gi('sensRate').value||0)/100;
  const sensContrib = (+gi('sensContrib').value||0);
  const workM = Math.max(-0.99, m*(1+sensRate));
  const workAnnual = monthlyToAnnual(workM);

  const params = {
    initial:+gi('initial').value||0, contrib:(+gi('contrib').value||0)+sensContrib, contribFreq:+gi('contribFreq').value||0,
    rate:workAnnual, fee:+gi('fee').value||0, infl:+gi('infl').value||0, compound:+gi('compound').value||0,
    years:+gi('years').value||0, currency:gi('currency').value, timing:'end'
  };
  const base = simulate(params);

  gi('final').textContent=fmt(params.currency,base.final);
  gi('tcontrib').textContent=fmt(params.currency,base.totalC);
  gi('tinterest').textContent=fmt(params.currency,base.interest);

  // Scenarios based on ±vol
  const pM = Math.max(-0.99, m*(1-delta));
  const oM = m*(1+delta);
  const pess = simulate({...params, rate: monthlyToAnnual(pM)});
  const opt  = simulate({...params, rate: monthlyToAnnual(oM)});

  const labels=base.yearly.map(y=>y.year);
  const ctx=document.getElementById('chart').getContext('2d'); if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'line',data:{labels,datasets:[
    {label:'Внесено',data:base.investedYearly,borderColor:'#ff8a2a',backgroundColor:'rgba(255,138,42,.18)',fill:true,tension:.25},
    {label:'Пессимистичный',data:pess.yearly.map(y=>y.balance),borderColor:'#ff5bbd',backgroundColor:'transparent',tension:.25,borderDash:[6,6]},
    {label:'Итог (база)',data:base.yearly.map(y=>y.balance),borderColor:'#38e8ff',backgroundColor:'transparent',tension:.25},
    {label:'Оптимистичный',data:opt.yearly.map(y=>y.balance),borderColor:'#9cff70',backgroundColor:'transparent',tension:.25,borderDash:[6,6]}
  ]},options:{plugins:{legend:{labels:{color:'#d7eaff'}}},scales:{x:{ticks:{color:'#9fb7ff'}},y:{ticks:{color:'#9fb7ff'}}}}});

  gi('tbody').innerHTML = base.yearly.map(y=> `<tr><td>${y.year}</td><td>${fmt(params.currency,y.balance)}</td><td>${fmt(params.currency,y.real)}</td></tr>`).join('');

  // Affiliate (unchanged features)
  const months = +gi('affMonths').value || (params.years*12);
  const dep = params.initial;
  const opt50 = dep>=3000, opt60=dep>=10000, opt70=dep>=20000;
  Array.from(gi('ownSharePct').options).forEach(o=>{
    const v=+o.value; o.disabled=(v===50 && !opt50) || (v===60 && !opt60) || (v===70 && !opt70);
  });
  let selected = +gi('ownSharePct').value;
  if((selected===70 && !opt70) || (selected===60 && !opt60) || (selected===50 && !opt50)){
    selected = opt70?70:(opt60?60:(opt50?50:0));
    gi('ownSharePct').value = selected || 50;
  }
  const partnerShare = 100 - (selected||0);
  gi('partnerShareText').textContent = partnerShare + '%';
  gi('ownShareHint').textContent = selected?`Вы берёте ${selected}% от своей прибыли за период.`:'Недоступно при депозите < $3k';
  gi('ownShareLock').textContent = selected?`Доступно по порогу: выбрана доля ${selected}%`:`Депозит ниже $3k — доля не активна.`;
  const ownShare = (selected||0)/100;

  // Avg partner monthly profit from deposits mix and MONTHLY m
  let avgMonthProfit = 0;
  if(gi('calcAvgFromDep').checked){
    const dA=+gi('depA').value||3000, dB=+gi('depB').value||10000, dC=+gi('depC').value||20000;
    let wA=+gi('wA').value||0, wB=+gi('wB').value||0, wC=+gi('wC').value||0;
    const total=(wA+wB+wC)||1; wA/=total; wB/=total; wC/=total;
    avgMonthProfit = dA*wA*m + dB*wB*m + dC*wC*m;
    gi('affAvgCalc').textContent = fmt(params.currency, avgMonthProfit);
  } else { avgMonthProfit = 200; gi('affAvgCalc').textContent = '—'; }

  const L1=+gi('affL1').value||0, L2=+gi('affL2').value||0, L3=+gi('affL3').value||0, L4=+gi('affL4').value||0;
  const l1ok = dep>=3000, l2ok=dep>=3000, l3ok=dep>=10000, l4ok=dep>=20000;
  const l1m = l1ok ? avgMonthProfit*0.05*L1 : 0;
  const l2m = l2ok ? avgMonthProfit*0.08*L2 : 0;
  const l3m = l3ok ? avgMonthProfit*0.10*L3 : 0;
  const l4m = l4ok ? avgMonthProfit*0.02*L4 : 0;
  gi('l1m').textContent = fmt(params.currency,l1m);
  gi('l2m').textContent = fmt(params.currency,l2m);
  gi('l3m').textContent = fmt(params.currency,l3m);
  gi('l4m').textContent = fmt(params.currency,l4m);
  gi('affLevelsHint').textContent = `Уровни активны: ${l1ok?'1':''}${l2ok?',2':''}${l3ok?',3':''}${l4ok?',4':''}`.replace(/^,|,,/g,'');
  const affTotal = (l1m+l2m+l3m+l4m) * months;

  const ownIncome = ownShare * Math.max(0, base.interest);
  gi('ownShare').textContent = fmt(params.currency, ownIncome);
  const grand = ownIncome + affTotal;
  gi('affTotal').textContent = fmt(params.currency, affTotal);
  gi('grandTotal').textContent = fmt(params.currency, grand);
  gi('affPerMonth').textContent = `В среднем в месяц: ${fmt(params.currency, grand/Math.max(1,months))}`;
}
render();
</script>
</body>
</html>
