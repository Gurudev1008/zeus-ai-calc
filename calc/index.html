<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ZEUS AI — Калькулятор (вкладки уровней партнёрки)</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cpath fill='%2338e8ff' d='M28 4l-6 20h10l-8 28 20-26H34l10-22z'/%3E%3C/svg%3E">
<style>
:root{--bg:#08132b;--panel:#0c1b3c;--panel2:#0a1535;--text:#e7f2ff;--muted:#a9c2ff;--cyan:#38e8ff;--border:#38e8ff33}
*{box-sizing:border-box} body{margin:0;background:radial-gradient(1000px 600px at 85% 10%, rgba(56,232,255,.08), transparent 70%),linear-gradient(180deg,#0f1e47,#08132b 40%,#071028 100%);color:var(--text);font-family:Inter,system-ui}
.wrap{max-width:1200px;margin:0 auto;padding:22px 14px 40px}
.top{display:flex;justify-content:space-between;gap:10px;align-items:center}
.badge{border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:linear-gradient(180deg,#10245a,#0b193f)}
h1{margin:8px 0 10px;color:#9ee8ff;font-size:22px}
.grid{display:grid;grid-template-columns:1.05fr .95fr;gap:16px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--border);border-radius:16px;padding:14px}
.pill{font-size:12px;color:#bfeaff;border:1px solid var(--border);padding:3px 8px;border-radius:12px}
.title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.row{display:grid;gap:10px}.two{grid-template-columns:repeat(2,minmax(160px,1fr))}
label{display:flex;flex-direction:column;gap:6px;font-size:13px;color:var(--muted)}
input,select{background:#0a1535;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px 12px}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px}
.kpi{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:12px;padding:10px}
.k{font-size:12px;color:#a9c2ff}.v{font-weight:700}
.canv{background:linear-gradient(180deg,#0a1840,#091537);border:1px solid var(--border);border-radius:14px;padding:10px}
canvas{width:100%;height:360px;display:block}
.i{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;margin-left:6px;border-radius:50%;border:1px solid var(--border);color:#9bdfff;font-size:12px;cursor:help;position:relative}
.i:hover::after{content:attr(data-tip);position:absolute;left:20px;top:-4px;min-width:220px;max-width:360px;background:#0a1840;color:#cfeaff;border:1px solid var(--border);padding:8px 10px;border-radius:10px;white-space:normal;z-index:10}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
.tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:#0a1840;color:#bfeaff;cursor:pointer;user-select:none}
.tab.active{background:#12305e;color:#fff}
.legend{display:flex;gap:8px;margin:8px 0;flex-wrap:wrap}
.chip{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:#0a1840}
.dot{width:10px;height:10px;border-radius:50%}
.note{font-size:12px;color:#9fb7ff;margin-top:4px}
.menu{display:flex;gap:8px;flex-wrap:wrap}
.btn{background:#10245a;border:1px solid var(--border);color:#fff;border-radius:12px;padding:8px 12px;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div style="display:flex;align-items:center;gap:10px">
      <div class="badge">ZEUS&nbsp;AI</div><h1>Калькулятор сложных процентов</h1>
    </div>
    <div class="menu">
      <button class="btn" id="btnShare">Поделиться</button>
      <button class="btn" id="btnCSV">CSV</button>
      <button class="btn" id="btnPNG">PNG</button>
      <button class="btn" id="btnPDF">PDF</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="title"><h3>Параметры</h3><span class="pill">ввод</span></div>
      <div class="row two">
        <label>Годовая ставка, % <span class="i" data-tip="Номинальная годовая ставка (APR). Комиссия вычитается ниже.">i</span><input id="rate" type="number" value="24" step="0.01"></label>
        <label>Комиссия, % <span class="i" data-tip="Годовые издержки: вычитаются из ставки перед начислением.">i</span><input id="fee" type="number" value="0" step="0.01"></label>
      </div>
      <div class="row two">
        <label>Первоначальная сумма <span class="i" data-tip="Стартовый депозит. ≥ $3,000 — включается собственный доход 50% от процентов.">i</span><input id="initial" type="number" value="3000"></label>
        <label>Регулярное пополнение <span class="i" data-tip="Сумма взноса, вносимая каждый период (см. частоту).">i</span><input id="contrib" type="number" value="0"></label>
      </div>
      <div class="row two">
        <label>Частота пополнений <span class="i" data-tip="Раз в год: 1/4/12. 0 — без пополнений.">i</span><select id="contribFreq"><option value="12">Ежемесячно (12)</option><option value="4">Ежеквартально (4)</option><option value="1">Ежегодно (1)</option><option value="0" selected>Без пополнений</option></select></label>
        <label>Капитализация <span class="i" data-tip="Сколько раз в год начисляются проценты.">i</span><select id="compound"><option value="12">Ежемесячно (12)</option><option value="4">Ежеквартально (4)</option><option value="1" selected>Ежегодно (1)</option></select></label>
      </div>
      <div class="row two">
        <label>Срок, лет <span class="i" data-tip="Горизонт моделирования в годах.">i</span><input id="years" type="number" value="3"></label>
        <label>Инфляция, % <span class="i" data-tip="Используется для колонки «Реально (с инфл.)».">i</span><input id="infl" type="number" value="0"></label>
      </div>
      <div class="row two">
        <label>Момент пополнения <span class="i" data-tip="«В начале» — взнос сразу в работе; «В конце» — со следующего периода.">i</span><select id="timing"><option value="begin" selected>В начале периода</option><option value="end">В конце периода</option></select></label>
        <label>Валюта <span class="i" data-tip="Только символ отображения.">i</span><select id="currency"><option value="$" selected>$</option><option value="€">€</option><option value="₽">₽</option></select></label>
      </div>
      <div class="kpis">
        <div class="kpi"><div class="k">Внесено, всего</div><div class="v" id="tcontrib">—</div></div>
        <div class="kpi"><div class="k">Начислено процентов</div><div class="v" id="tinterest">—</div></div>
        <div class="kpi"><div class="k">EAR (эффективная)</div><div class="v" id="earVal">—</div></div>
      </div>
    </div>

    <div class="card">
      <div class="title"><h3>Результаты</h3><span class="pill">график + таблица</span></div>
      <div class="canv"><canvas id="chart"></canvas></div>
      <div class="note">ⓘ График показывает динамику «Внесено» и «Итог» по годам, с учётом сложных процентов.</div>
      <table style="width:100%;border-collapse:collapse;margin-top:8px">
        <thead><tr style="background:#0a1840;color:#bfeaff"><th style="text-align:left;padding:8px">Год</th><th style="text-align:right;padding:8px">Баланс</th><th style="text-align:right;padding:8px">Реально (с инфл.)</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <div class="title"><h3>Партнёрская программа</h3><span class="pill">доход</span></div>
    <div class="row two">
      <label><span>Учитывать партнёрку <span class="i" data-tip="Выключите, если хотите считать только собственный депозит.">i</span></span><input id="affOn" type="checkbox" checked></label>
      <label>Средняя прибыль партнёра / месяц <span class="i" data-tip="Средняя чистая прибыль одного подключённого инвестора за месяц.">i</span><input id="affAvg" type="number" value="200"></label>
    </div>
    <div class="row two">
      <label>Месяцев учёта <span class="i" data-tip="На сколько месяцев суммировать партнёрский доход.">i</span><input id="affMonths" type="number" value="48"></label>
      <span class="note">ⓘ Ставки уровней: L1 5%, L2 8%, L3 10%, L4 2%. Собственный доход: 50% от процентов при депозите ≥ $3,000.</span>
    </div>
    <div class="row two">
      <label>L1 — личные <span class="i" data-tip="Ваши прямые подключения (5%).">i</span><input id="affL1" type="number" value="20"></label>
      <label>L2 — рефералы L1 <span class="i" data-tip="Партнёры, приглашённые вашими L1 (8%).">i</span><input id="affL2" type="number" value="50"></label>
    </div>
    <div class="row two">
      <label>L3 — рефералы L2 <span class="i" data-tip="Партнёры третьего уровня (10%).">i</span><input id="affL3" type="number" value="100"></label>
      <label>L4 — глубина <span class="i" data-tip="Партнёры четвёртого уровня (2%).">i</span><input id="affL4" type="number" value="300"></label>
    </div>

    <div class="tabs">
      <div class="tab active" data-view="all">Все уровни</div>
      <div class="tab" data-view="l1">L1</div>
      <div class="tab" data-view="l2">L2</div>
      <div class="tab" data-view="l3">L3</div>
      <div class="tab" data-view="l4">L4</div>
      <div class="tab" data-view="own">Собственный</div>
    </div>
    <div class="legend">
      <div class="chip"><span class="dot" style="background:#6ec1ff"></span> Месяц</div>
      <div class="chip"><span class="dot" style="background:#ff8ea1"></span> 1 год</div>
      <div class="chip"><span class="dot" style="background:#8effa4"></span> 2 года</div>
      <div class="chip"><span class="dot" style="background:#f8d47b"></span> 3 года</div>
    </div>
    <div class="canv"><canvas id="affChart"></canvas></div>
    <div class="kpis">
      <div class="kpi"><div class="k">Собственный доход (50% процентов)</div><div class="v" id="ownShare">—</div></div>
      <div class="kpi"><div class="k">Партнёрский доход за период</div><div class="v" id="affTotal">—</div></div>
      <div class="kpi"><div class="k">Итого: собственный + партнёрский</div><div class="v" id="grandTotal">—</div></div>
    </div>
    <div class="note" id="affPerMonth">В среднем в месяц: —</div>
  </div>
</div>

<script>
(function(global){
  function Legend(ctx, labels, colors, x, y){
    ctx.font = "12px Inter, Arial"; ctx.textBaseline = "middle";
    let off = 0; labels.forEach((lab, idx)=>{ const col = colors[idx % colors.length]; ctx.fillStyle = col; ctx.fillRect(x+off, y-6, 12, 12); ctx.fillStyle = "#cfeaff"; ctx.fillText(lab, x+off+16, y); off += ctx.measureText(lab).width + 36; });
  }
  function scale(arr){ let min = Math.min(...arr), max = Math.max(...arr); if(!isFinite(min)||!isFinite(max)){min=0;max=1;} if(min===max) max=min+1; return {min, max}; }
  class Chart{
    constructor(ctx, config){ this.ctx = ctx; this.config = JSON.parse(JSON.stringify(config||{})); this._destroyed=false; this.draw(); }
    destroy(){ this._destroyed=true; this.ctx=null; this.config=null; }
    update(){ this.draw(); }
    draw(){
      if(this._destroyed) return;
      const c = this.ctx.canvas, ctx = this.ctx, dpr = window.devicePixelRatio||1;
      c.width = c.clientWidth * dpr; c.height = c.clientHeight * dpr; ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,c.clientWidth,c.clientHeight);
      const padding={left:60,right:24,top:36,bottom:34}, W=c.clientWidth,H=c.clientHeight, areaW=W-padding.left-padding.right, areaH=H-padding.top-padding.bottom;
      const labels=(this.config.data&&this.config.data.labels)||[], datasets=(this.config.data&&this.config.data.datasets)||[];
      ctx.strokeStyle="rgba(160,200,255,.25)"; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(padding.left,padding.top); ctx.lineTo(padding.left,H-padding.bottom); ctx.lineTo(W-padding.right,H-padding.bottom); ctx.stroke();
      const all=[]; datasets.forEach(ds=>(ds.data||[]).forEach(v=>{ if(isFinite(v)) all.push(v);})); const ys=scale(all.length?all:[0,1]); const yMin=Math.min(0,ys.min), yMax=ys.max*1.15;
      function xPos(i){ if(labels.length<=1) return padding.left+areaW*0.05+i*30; const t=i/(labels.length-1); return padding.left+t*areaW; }
      function yPos(v){ const t=(v-yMin)/Math.max(1e-9,(yMax-yMin)); return (H-padding.bottom) - t*areaH; }
      ctx.fillStyle="#9fb7ff"; ctx.font="12px Inter, Arial"; const ticks=6;
      for(let ti=0;ti<=ticks;ti++){ const v=yMin+(yMax-yMin)*ti/ticks, y=yPos(v); ctx.strokeStyle="rgba(160,200,255,.12)"; ctx.beginPath(); ctx.moveTo(padding.left,y); ctx.lineTo(W-padding.right,y); ctx.stroke(); ctx.fillText(v.toLocaleString(undefined,{maximumFractionDigits:0}), 10,y); }
      const palette=["#6ec1ff","#ff8ea1","#8effa4","#f8d47b","#caa0ff","#73e3e8"]; const groupW=(labels.length? areaW/labels.length : 50);
      datasets.forEach((ds,di)=>{
        const col=ds.color||palette[di%palette.length];
        if((this.config.type||"line")==="line"){
          ctx.strokeStyle=col; ctx.lineWidth=2.2; ctx.beginPath(); (ds.data||[]).forEach((v,i)=>{ const x=xPos(i), y=yPos(v); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke(); if(ds.fill){ const base=yPos(0); ctx.lineTo(xPos((ds.data||[]).length-1),base); ctx.lineTo(xPos(0),base); ctx.closePath(); ctx.fillStyle=col+"33"; ctx.fill(); }
        } else if(this.config.type==="bar"){
          const barsPerGroup=Math.max(1,datasets.length); const bw=groupW*0.66/barsPerGroup; const shift=(barsPerGroup*bw)/2;
          (ds.data||[]).forEach((v,i)=>{ const center=xPos(i); const x=center-shift+di*bw+2; const y=yPos(v); const base=yPos(0); ctx.fillStyle=col; const h=Math.abs(base-y), yy=Math.min(y,base), r=Math.min(8,h/2);
            ctx.beginPath(); ctx.moveTo(x,yy+h); ctx.lineTo(x,yy+r); ctx.quadraticCurveTo(x,yy,x+r,yy); ctx.lineTo(x+bw-r,yy); ctx.quadraticCurveTo(x+bw,yy,x+bw,yy+r); ctx.lineTo(x+bw,yy+h); ctx.closePath(); ctx.fill();
            if(ds.showValues){ ctx.fillStyle="#d7eaff"; ctx.font="11px Inter, Arial"; ctx.textAlign="center"; ctx.fillText(((v||0)).toLocaleString(undefined,{maximumFractionDigits:0}), x+bw/2, yy-6); }
          });
        }
      });
      Legend(ctx, datasets.map(d=>d.label||""), palette, padding.left, 16);
    }
  }
  global.Chart = Chart;
})(this);
</script>

<script>
const i = id => document.getElementById(id);
function lcm(a,b){const g=(x,y)=>y===0?x:g(y,x%y);return a*b/g(a,b)}
function fmt(sym,n){return sym+' '+(+n).toLocaleString(undefined,{maximumFractionDigits:2})}
let mainChart=null, affChart=null, currentView='all';

function getParams(){
  return {rate:+i('rate').value||0, fee:+i('fee').value||0, initial:+i('initial').value||0, contrib:+i('contrib').value||0,
    contribFreq:+i('contribFreq').value||0, compound:+i('compound').value||0, years:+i('years').value||0, infl:+i('infl').value||0,
    timing:i('timing').value, currency:i('currency').value, affOn:i('affOn').checked, affAvg:+i('affAvg').value||0,
    affMonths:+i('affMonths').value||0, affL1:+i('affL1').value||0, affL2:+i('affL2').value||0, affL3:+i('affL3').value||0, affL4:+i('affL4').value||0};
}
function simulate(p){
  const n=Math.max(1,Math.floor(p.compound)); const m=Math.max(0,Math.floor(p.contribFreq));
  const steps=(m===0? n : lcm(n,m)), compoundEvery=steps/n, contribEvery=(m===0? Infinity : steps/m);
  const rNet=(p.rate-p.fee)/100; let bal=+p.initial||0, totalC=0, invested=+p.initial||0;
  const yearly=[], investedYearly=[];
  for(let y=1;y<=p.years;y++){
    for(let s=1;s<=steps;s++){
      if(p.timing==='begin' && ((s-1)%contribEvery===0) && p.contrib>0){bal+=+p.contrib; totalC+=+p.contrib; invested+=+p.contrib;}
      if(s%compoundEvery===0){ bal*=1+(rNet/n); }
      if(p.timing==='end' && (s%contribEvery===0) && p.contrib>0){bal+=+p.contrib; totalC+=+p.contrib; invested+=+p.contrib;}
    }
    const real=p.infl>0? bal/Math.pow(1+p.infl/100,y):bal;
    yearly.push({year:y,balance:bal,real:+real.toFixed(2)}); investedYearly.push(invested);
  }
  const ear=Math.pow(1+(rNet/n),n)-1; return {final:bal,interest:bal-(+p.initial+totalC),yearly,investedYearly,ear};
}

function render(){
  const p=getParams(); const r=simulate(p);
  const contributed=(p.contribFreq>0?p.years*p.contribFreq:0)*p.contrib;
  i('tcontrib').textContent=fmt(p.currency,contributed);
  i('tinterest').textContent=fmt(p.currency,r.interest);
  i('earVal').textContent=(r.ear*100).toFixed(2)+'%';
  const tb=i('tbody'); tb.innerHTML='';
  r.yearly.forEach(y=>{const tr=document.createElement('tr'); tr.innerHTML=`<td style="padding:8px">${y.year}</td><td style="padding:8px;text-align:right">${fmt(p.currency,y.balance)}</td><td style="padding:8px;text-align:right">${fmt(p.currency,y.real)}</td>`; tb.appendChild(tr);});
  const labels=r.yearly.map(y=>y.year), balances=r.yearly.map(y=>y.balance), invested=r.investedYearly;
  const ctx=i('chart').getContext('2d'); if(mainChart) mainChart.destroy();
  mainChart=new Chart(ctx,{type:'line', data:{labels, datasets:[{label:'Внесено',data:invested,fill:true,color:'#6ec1ff'},{label:'Итог',data:balances,fill:false,color:'#f8d47b'}]}});

  const L=[p.affL1,p.affL2,p.affL3,p.affL4], R=[0.05,0.08,0.10,0.02], avg=Math.max(0,p.affAvg);
  const mon = L.map((n,i)=> p.affOn? avg*(R[i]*n):0);
  const ownIncome=(p.initial>=3000)? Math.max(0, r.interest*0.5):0;
  const affIncome=p.affOn? p.affMonths*(mon[0]+mon[1]+mon[2]+mon[3]):0; const grand=ownIncome+affIncome;
  i('ownShare').textContent=fmt(p.currency,ownIncome); i('affTotal').textContent=fmt(p.currency,affIncome);
  i('grandTotal').textContent=fmt(p.currency,grand); i('affPerMonth').textContent='В среднем в месяц: '+fmt(p.currency,grand/Math.max(1,p.affMonths));

  const ac=i('affChart').getContext('2d'); if(affChart) affChart.destroy();
  const labelsAll=['L1','L2','L3','L4'];
  function ds(values){ return [
    {label:'Месяц', data:values, color:'#6ec1ff', showValues:true},
    {label:'1 год', data:values.map(v=>v*12), color:'#ff8ea1', showValues:true},
    {label:'2 года', data:values.map(v=>v*24), color:'#8effa4', showValues:true},
    {label:'3 года', data:values.map(v=>v*36), color:'#f8d47b', showValues:true},
  ];}
  let data;
  if(currentView==='all'){ data={labels:labelsAll, datasets: ds(mon)}; }
  else if(currentView==='own'){
    const values=[ ownIncome/Math.max(1,p.affMonths) ]; // приводим к "месяц"
    data={labels:['Own'], datasets: ds([values[0]])}; // остальные горизонты строятся внутри ds
  } else {
    const idx={l1:0,l2:1,l3:2,l4:3}[currentView];
    data={labels:[currentView.toUpperCase()], datasets: ds([mon[idx]])};
  }
  affChart=new Chart(ac,{type:'bar', data});
}

function setTab(view){
  currentView=view;
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.dataset.view===view));
  render();
}

function bind(){
  ['rate','fee','initial','contrib','contribFreq','compound','years','infl','timing','currency','affOn','affAvg','affMonths','affL1','affL2','affL3','affL4']
    .forEach(id=>{ const el=i(id); if(el){ el.addEventListener('input',render); el.addEventListener('change',render);} });
  document.querySelectorAll('.tab').forEach(t=> t.addEventListener('click', ()=> setTab(t.dataset.view)));
  i('btnShare').addEventListener('click', ()=>{ const u=new URL(location.href.split('?')[0]); Object.entries(getParams()).forEach(([k,v])=>u.searchParams.set(k,String(v))); history.replaceState(null,'',u.toString()); navigator.clipboard&&navigator.clipboard.writeText(u.toString()); alert('Ссылка скопирована'); });
  i('btnCSV').addEventListener('click', ()=>{ const p=getParams(); const r=simulate(p); const rows=[['Год','Баланс','Реально (с инфл.)']]; r.yearly.forEach(y=>rows.push([y.year,y.balance,y.real])); const L=[p.affL1,p.affL2,p.affL3,p.affL4], R=[0.05,0.08,0.10,0.02], avg=Math.max(0,p.affAvg); const mon=L.map((n,i)=> p.affOn? avg*(R[i]*n):0); rows.push([]); rows.push(['L','Месяц','1 год','2 года','3 года']); [['L1',0],['L2',1],['L3',2],['L4',3]].forEach(([k,idx])=>rows.push([k,mon[idx],mon[idx]*12,mon[idx]*24,mon[idx]*36])); const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('
'); const a=document.createElement('a'); a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv); a.download='zeus_calc.csv'; a.click(); });
  i('btnPNG').addEventListener('click', ()=>{ const a=document.createElement('a'); a.href=i('affChart').toDataURL('image/png'); a.download='partner_chart.png'; a.click(); });
  i('btnPDF').addEventListener('click', ()=>window.print());
}
bind(); render();
</script>
</body>
</html>
